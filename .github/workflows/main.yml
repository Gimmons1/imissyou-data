name: Aggiorna Biblioteca Memoria

on:
  schedule:
    # Esegue lo script ogni 6 ore
    - cron: '0 */6 * * *'
  workflow_dispatch: # Permette l'avvio manuale dal sito GitHub

# Permessi necessari per creare la Pull Request senza errori
permissions:
  contents: write
  pull-requests: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout del codice sorgente
        uses: actions/checkout@v3

      - name: Configurazione Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Installazione librerie (Requests e Feedparser)
        run: pip install requests feedparser

      - name: Esecuzione script Segugio
        run: python updater.py

      - name: Creazione Pull Request per Validazione Admin
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "ðŸ¤– Aggiornamento automatico biblioteca"
          title: "Verifica nuovi decessi rilevati"
          body: "Lo script ha cercato su ANSA e BBC e ha trovato potenziali notizie. Controlla il file library.json e approva per pubblicare nell'app."
          branch: "update-library"
          delete-branch: true
