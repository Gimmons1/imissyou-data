name: Aggiorna Biblioteca Memoria

on:
  schedule:
    # Esegue lo script in automatico ogni 6 ore
    - cron: '0 */6 * * *'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout del codice sorgente
        uses: actions/checkout@v3

      - name: Configurazione Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Installazione librerie
        run: pip install requests feedparser

      - name: Esecuzione script Segugio (Ricerca nuovi decessi)
        run: python updater.py

      - name: Esecuzione Riparatore Immagini (Riparazione automatica foto)
        run: python auto_fixer.py

      - name: Creazione Pull Request per Validazione Admin
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "ðŸ¤– Aggiornamento e Riparazione Automatica"
          title: "Verifica nuovi decessi e foto aggiornate"
          body: "Il sistema cloud ha trovato nuove notizie o ha riparato foto mancanti attingendo dagli archivi Wikimedia. Controlla e approva per aggiornare l'App."
          branch: "update-library"
          delete-branch: true
